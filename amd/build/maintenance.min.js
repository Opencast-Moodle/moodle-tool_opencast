define("tool_opencast/maintenance",["exports","core/ajax","core/notification","core/str","core/toast"],(function(_exports,Ajax,Notification,Str,Toast){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}
/**
   * Javascript to handle maintenance mode in tool opencast.
   *
   * @module     tool_opencast/maintenance
   * @copyright  2024 Farbod Zamani Boroujeni (zamani@elan-ev.de)
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,Ajax=_interopRequireWildcard(Ajax),Notification=_interopRequireWildcard(Notification),Str=_interopRequireWildcard(Str),Toast=_interopRequireWildcard(Toast);_exports.init=()=>{Str.get_strings([{key:"maintenancemode_modal_sync_confirmation_title",component:"tool_opencast"},{key:"maintenancemode_modal_sync_confirmation_text",component:"tool_opencast"},{key:"maintenancemode_modal_sync_confirmation_btn",component:"tool_opencast"},{key:"maintenancemode_modal_sync_error_title",component:"tool_opencast"},{key:"maintenancemode_modal_sync_error_noinstance_message",component:"tool_opencast"},{key:"maintenancemode_modal_sync_failed",component:"tool_opencast"},{key:"maintenancemode_modal_sync_succeeded",component:"tool_opencast"}]).then((function(jsstrings){document.querySelectorAll(".form-setting .opencast_config_dt_selector").forEach((dtblock=>{var _dtblock$dataset;if(null!=dtblock&&null!==(_dtblock$dataset=dtblock.dataset)&&void 0!==_dtblock$dataset&&_dtblock$dataset.isoptional){var _enablingelement$chec;const enablingelement=document.getElementById("".concat(dtblock.dataset.settingid,"_enabled")),initialvalue=null!==(_enablingelement$chec=null==enablingelement?void 0:enablingelement.checked)&&void 0!==_enablingelement$chec&&_enablingelement$chec,selects=dtblock.querySelectorAll(".opencast-config-dt-select");selects.forEach((select=>{select.disabled=!initialvalue})),enablingelement.addEventListener("change",(event=>{selects.forEach((select=>{select.disabled=!event.target.checked}))}))}}));document.querySelectorAll(".maintenance-sync-btn").forEach((btn=>{btn.addEventListener("click",(e=>{var _e$target,_e$target$dataset;e.preventDefault();const ocinstanceid=null===(_e$target=e.target)||void 0===_e$target||null===(_e$target$dataset=_e$target.dataset)||void 0===_e$target$dataset?void 0:_e$target$dataset.ocinstanceid;ocinstanceid?Notification.confirm(jsstrings[0],jsstrings[1],jsstrings[2],null,(()=>performSync(ocinstanceid,jsstrings))):Notification.alert(jsstrings[3],jsstrings[4])})),btn.removeAttribute("disabled"),btn.removeAttribute("title"),btn.classList.remove("disabled"),btn.classList.remove("btn-warning"),btn.classList.add("btn-primary")}))})).catch(Notification.exception)};const performSync=(ocinstanceid,jsstrings)=>{ocinstanceid&&Ajax.call([{methodname:"tool_opencast_maintenance_sync",args:{ocinstanceid:ocinstanceid}}])[0].then((data=>{null!=data&&data.status?(Toast.add(jsstrings[6],{type:"success"}),reloadWithDelay()):Toast.add(jsstrings[5],{type:"danger"})})).catch((error=>Notification.exception(error)))},reloadWithDelay=function(){let delay=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3;setTimeout((()=>{window.location.reload()}),delay)}}));

//# sourceMappingURL=maintenance.min.js.map