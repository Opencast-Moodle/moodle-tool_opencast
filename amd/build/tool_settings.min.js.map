{"version":3,"sources":["../src/tool_settings.js"],"names":["init","instancesinputid","str","get_strings","key","component","then","jsstrings","instancesinput","parent","hide","next","instancestable","Tabulator","data","JSON","parse","val","layout","dataChanged","stringify","columns","title","field","editor","widthGrow","hozAlign","formatter","cell","input","document","createElement","type","checked","getValue","addEventListener","getRow","update","prop","width","headerSort","cellClick","e","ModalFactory","create","types","SAVE_CANCEL","body","modal","setSaveButtonText","getRoot","on","ModalEvents","save","delete","show","click","instances","id","forEach","x","addRow"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript to initialise the opencast tool settings.\n *\n * @package    tool_opencast\n * @copyright  2021 Tamara Gunkel, University of MÃ¼nster\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Tabulator from 'block_opencast/tabulator';\nimport $ from 'jquery';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport * as str from 'core/str';\n\nexport const init = (instancesinputid) => {\n\n    // Load strings\n    var strings = [\n        {key: 'name', component: 'tool_opencast'},\n        {key: 'isvisible', component: 'tool_opencast'},\n        {key: 'addinstance', component: 'tool_opencast'},\n        {key: 'delete_instance', component: 'tool_opencast'},\n        {key: 'delete_instance_confirm', component: 'tool_opencast'},\n        {key: 'delete', component: 'moodle'}\n    ];\n    str.get_strings(strings).then(function (jsstrings) {\n        // Style hidden input.\n        var instancesinput = $('#' + instancesinputid);\n        instancesinput.parent().hide();\n        instancesinput.parent().next().hide(); // Default value.\n\n        var instancestable = new Tabulator(\"#instancestable\", {\n            data: JSON.parse(instancesinput.val()),\n            layout: \"fitColumns\",\n            dataChanged: function (data) {\n                // TODO make sure that there is at least one.\n             //    data = data.filter(value => value.name); // todo warn user instead if name is empty\n                instancesinput.val(JSON.stringify(data));\n            },\n            columns: [\n                {title: 'ID', field: \"id\"}, // TODO allow admins to change the ID (should only be used for importing settings)\n                {title: jsstrings[0], field: \"name\", editor: \"input\", widthGrow: 4,},\n                {\n                    title: jsstrings[1],\n                    field: \"isvisible\",\n                    hozAlign: \"center\",\n                    widthGrow: 0,\n                    formatter: function (cell) {\n                        var input = document.createElement('input');\n                        input.type = 'checkbox';\n                        input.checked = cell.getValue();\n                        input.addEventListener('click', function () {\n                            cell.getRow().update({'isvisible': $(this).prop('checked') ? 1 : 0});\n                        });\n                        return input;\n                    }\n                },\n                {\n                    title: \"\",\n                    width: 40,\n                    headerSort: false,\n                    hozAlign: \"center\",\n                    formatter: function () {\n                        return '<i class=\"icon fa fa-trash fa-fw\"></i>';\n                    },\n                    cellClick: function (e, cell) {\n                        ModalFactory.create({\n                            type: ModalFactory.types.SAVE_CANCEL,\n                            title: jsstrings[3],\n                            body: jsstrings[4]\n                        })\n                            .then(function (modal) {\n                                modal.setSaveButtonText(jsstrings[5]);\n                                modal.getRoot().on(ModalEvents.save, function () {\n                                    cell.getRow().delete();\n                                });\n                                modal.show();\n                            });\n                    }\n                }\n            ],\n        });\n\n        $('#addrow-instancestable').click(function () {\n            var instances = JSON.parse(instancesinput.val());\n            var id = 0;\n            instances.forEach(function (x) {\n                if (x.id > id) {\n                    id = x.id;\n                }\n            });\n            instancestable.addRow({'id': id + 1, 'isvisible': false, 'isdefault': false});\n        });\n    });\n};\n\n"],"file":"tool_settings.min.js"}